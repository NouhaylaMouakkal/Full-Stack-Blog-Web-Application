<!DOCTYPE html>
<html>
<head>
  <title>Interface de l'auteur</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

  <style>
    /* Add some CSS styles for the articles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f1f1f1;
      margin: 0;
      padding: 0;
    }

    h1 {
      color: #333;
      text-align: center;
      padding: 20px 0;
    }

    #articles {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 800px;
      margin: 0 auto;
    }

    article {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin: 10px;
      width: 300px;
      display: flex;
      flex-direction: column;
    }

    .articleTitle {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }

    .articleContent {
      color: #555;
      margin-bottom: 15px;
    }

    .articleImage {
      width: 100%;
      height: auto;
      margin-bottom: 15px;
    }

    .articleCreatedAt,
    .articleUpdatedAt,
    .userID {
      color: #888;
      margin-bottom: 5px;
    }
    
    .commentBox {
      margin-top: auto;
    }
/*=========================================================*/
.parent-of-articles {
display: flex;
flex-wrap: wrap;
justify-content: center;
}
article{
text-align: center;
border: 0.5px solid rgb(189, 189, 209);
border-radius: 5px;
margin: 40px 20px;
width: 320px;
/* color: rgb(185, 182, 182); */
color: rgb(9, 7, 121);
transition: 0.2s;
}
.dark article {
border: 0.5px solid antiquewhite;
}

article:hover {
border: 1px solid rgb(165, 64, 152);
/* background-color: rgba(219, 236, 255, 0.514); */
color: rgb(68, 73, 92);
border-left: 8px solid rgb(109, 45, 90);
}

.dark article:hover {
border: 2px solid antiquewhite;
/* background-color: rgba(219, 236, 255, 0.514); */
color: rgb(217, 219, 223);
border-left: 8px solid antiquewhite;
}

article h2 {
margin-top: 19px;
font-size: 24px;
font-weight: normal;
color: rgb(85, 72, 72);
}

.dark article h2 {
color: #f6fa1d;
}

article:hover h2 {
font-weight: 500;
}

article p {
line-height: 2;
font-size: 16px;
font-weight: normal;
text-align: left;
padding: 23px 9px;
}

.dark article p {
color: #dad5d5;
}

.btn {
font-weight: 700;
float: right;
}

.dark .btn {
color: rgb(187 204 255);
}
/*            Adding article                */
orm{
width: fit-content;
margin: auto;
}

input, label, textarea{
border-radius: 6px;
display: block;
width: 300px;
height: 35px;
}

label {
margin-bottom: 14px;
margin-top: 50px;
font-size: 23px;
font-weight: 400;
}

input {
border: 1px solid gray;
font-size: 20px;
}

textarea {
height: 170px !important;
width: 370px !important;
font-size: 20px;
}
input,textarea{
opacity: 0.7;
border-color: black;
margin-bottom: -30px;
}

.create {
all: unset;
background-color: rgb(255, 62, 62);
color: #ffffff;
margin: 28px;
padding: 3px 10px;
border-radius: 6px;
display: block;
font-size: 25px;
float: right;
}


.create:hover {
background-color: rgb(214, 55, 55);
font-size: 26px;
}

.create:active {
transform: scale(0.9);
background-color: tomato;
}
/* Center a div  */
.containerA {
display: flex;
justify-content: center;
align-items: center;
height: 100vh; /* Adjust as needed */
}

.center {
text-align: start;
}
sub{
float: right;
}
  </style>
</head>
<body>
  <div id="contact" class="card mb-3" style="max-width: 100%; background-color: inherit;" >
    <!-- NAV BAR FOR AUTHOR  -->
 <nav class="navbar bg-light fixed-top">
   <div class="container-fluid">
     <a class="navbar-brand" href="#"></a>
     <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
       <span class="navbar-toggler-icon"></span>
     </button>
     <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
       <div class="offcanvas-header">
         <h5 class="offcanvas-title" id="offcanvasNavbarLabel"></h5>
         <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
       </div>
       <div class="offcanvas-body">
         <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
           <li class="nav-item">
             <a class="nav-link active myarticles" aria-current="page" href="#myarticles">My Articles</a>
           </li>
           <li class="nav-item">
             <a class="nav-link add_articles" href="#newArticle">Add articles</a>
           </li>
           <li class="nav-item">
            <a class="nav-link home" href="#">Traindding Articles</a>
          </li>
           <li class="nav-item">
               <a href="#" class="nav-link"><i class="bi bi-box-arrow-right logout"  style="color: black;"></i></a>
           </li>
         </ul>
       </div>
     </div>
   </div>
 </nav>
 <br><br>
 <!-- ------------------------------------------------ -->
<!-- Trainding articles -->
<section id="articles">
    <h1>Articles de l'auteur</h1>
<article>
<div class="articleTitle">Titre de l'article 1</div>
<div class="articleContent">Contenu de l'article 1...</div>
<img src="" alt="Image de l'article 1" class="articleImage">
<div class="articleCreatedAt">Date de création :</div>
<div class="articleUpdatedAt">Date de modification :</div>
<div class="userID">ID de l'utilisateur :</div>
<div class="commentBox">Zone de commentaire</div>
</article>
</section>
<!-- My articles -->
<section id="myarticles">
<article>
<div class="myarticleTitle">Titre de l'article 1</div>
<div class="myarticleContent">Contenu de l'article 1...</div>
<img src="" alt="Image de l'article 1" class="myarticleImage">
<div class="myarticleCreatedAt">Date de création :</div>
<div class="myarticleUpdatedAt">Date de modification :</div>
</article>
</section>
<!-- Add Article -->
<div class="containerA">
<section id="newArticle">
 <h1 style="margin-top: 55px; margin-bottom: -30px;">Create new article</h1>
 <form class="center" id="addArticle_db">
   <label for="title">Article title: </label>
   <input id="title" type="text">
   <label for="body">Article body:</label>
   <textarea id="body"></textarea>
   <label for="image">Article Image : </label>
   <input id="image" type="file" accept="image/*">
   <input id="author_id" type="number" style="display: none;">    
   <br>     
   <a href="#myarticles" class="goto"><button class="create" type="submit">Create</button></a>
 </form>
</section>
</div>
<!-- **************************************************************************** -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $("a.home").click(function() {
      var articleURL = "http://localhost:3000/articles/";
      $.ajax({
    url: articleURL,
    method: 'GET',
    success: function(data) {
      $("#articles").empty(); // Clear existing articles

      data.forEach(function(article) {
        var articleHTML = '<article>' +
          '<div class="articleTitle">' + article.title + '</div>' +
          '<div class="articleContent">' + article.contenu + '</div>' +
          '<img src="' + article.image + '" alt="Image de l\'article" class="articleImage">' +
          '<div class="articleCreatedAt">Date de création: ' + article.createdAt + '</div>' +
          '<div class="articleUpdatedAt">Date de modification: ' + article.updatedAt + '</div>' +
          '<div class="userID">ID de l\'utilisateur: ' + article.userId + '</div>' +
          '<div class="commentBox">Zone de commentaire</div>' +
          '</article>';

        $("#articles").append(articleHTML);
      });
    },
    error: function() {
      $('#articles').text("Erreur lors du chargement des articles");
    }
  });
  });
  });
//Ajout de l'article à la base de données
$("#addArticle_db").submit(function(event) {
    event.preventDefault();
    var title_A = $("#title").val();
    var content_A = $("#body").val();
    var image_A = $('#image').val();
    var createdAt_A = new Date();
    var author_id = $('#author_id').val();

    var article = {
      title: title_A,
      contenu: content_A,
      image: image_A,
      createdAt: createdAt_A,
      userId: author_id
    };

    $.ajax({
      url: "http://localhost:3000/articles",
      type: 'POST',
      contentType: "application/json",
      data: JSON.stringify(article),
      success: function(response) {
        console.log("Article ajouté avec succès:", response);
      },
      error: function(xhr, status, error) {
        console.error("Erreur lors de l'ajout de l'article:", error);
      }
    });
  });
// My articles
$(document).ready(function() {
  var articleURL = "http://localhost:3000/myarticles/57";
  //Affichage
  $.ajax({
    url: articleURL,
    method: 'GET',
    success: function(data) {
      $("#articles").empty(); // Clear existing articles

      data.forEach(function(article) {
        var articleHTML = '<article>' +
          '<i class="bi bi-trash3 delete-icon">'+article.id+'</i>' +
          '<div class="articleTitle">' + article.title + '</div>' +
          '<div class="articleContent">' + article.contenu + '</div>' +
          '<img src="' + article.image + '" alt="Image de l\'article" class="articleImage">' +
          '<div class="articleCreatedAt">Date de création: ' + article.createdAt + '</div>' +
          '<div class="articleUpdatedAt">Date de modification: ' + article.updatedAt + '</div>' +
          '</article>';

        $("#articles").append(articleHTML);
      });
    },
    error: function() {
      $('#articles').text("Erreur lors du chargement des articles");
    }
  });

  // Deleting article
  $(document).on("click", ".delete-icon", function() {
    var articleId = $("i.delete-icon").val();
    var deleteArticleURL = "http://localhost:3000/articles/" + articleId;
console.log(articleId);
    $.ajax({
      url: deleteArticleURL,
      method: "DELETE",
      success: function() {
        $("#" + articleId).remove(); // Remove the article from the DOM
      },
      error: function() {
        // console.log("Erreur lors de la suppression de l'article");
        alert("The article deleted !")
      }
    });
  });
});

// return to my profile 
$(document).ready(function() {
  $("a.myarticles").click(function(){
    location.reload();
});
});
//new articles
  const add_article = document.querySelector(".containerA");
  const createButton = document.querySelector(".create");
  add_article.addEventListener("submit", (event) => {
    event.preventDefault();
    const title = document.getElementById("title").value;
    let content = document.getElementById("body").value;
    const image = document.getElementById("image").value;
    const createdAt = new Date();
    // Limiter le contenu à deux lignes
    let truncatedContent = content;
    const lines = content.split("\n");
    if (lines.length > 2) {
      truncatedContent = lines.slice(0, 2).join("\n");
    }
    // Afficher le nouvel article sur le profil
    document.getElementById("div_parent").innerHTML += `
<article>
  <i class="bi bi-trash3 delete-icon"></i>
  <div class="articleTitle"> ${article.title} </div>
  <div class="articleContent">${article.contenu} </div>
  <img src="${article.image}" alt="Image de l'article" class="articleImage">
  <div class="articleCreatedAt">Date de création: ${article.createdAt}</div>
  <div class="articleUpdatedAt">Date de modification:  ${article.updatedAt}</div>
</article>`;
      });


  // Default display
  $(document).ready(function() {
    $("div.containerA").hide();
    $("#myarticles").hide();
    $("#articles").show();
  })

  //
  $(document).ready(function() {
    $("a.myarticles").click(function(){
       $("div.containerA").hide();
    $("#myarticles").hide();
    $("#articles").show();
    })
  })
// Home display
$(document).ready(function(){
  $("a.home").click(function(){
     $("div.containerA").hide();
    $("#myarticles").hide();
    $("#articles").show();
  })
})
// display add articles
  $(document).ready(function(){
    $("a.add_articles").click(function(){
      $("#articles").hide();
    $("div.containerA").show();
    })
  })
  //
  $(document).ready(function(){
    $("a.goto").click(function(){
      $("#newArticle").hide();
      $("#myarticles").show();
    })
  })
//display my articles 
$(document).ready(function(){
  $("a.myarticles").click(function(){
     $("div.containerA").hide();
    $("#articles").hide();
    $("#myarticles").show();
  })
})

//Log out
$(document).ready(function(){
  $("i.logout").click(function(){
    window.location.href="index.html"
  })
})
  </script>
</body>
</html>